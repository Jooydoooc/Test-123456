<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Past Perfect & Past Perfect Continuous Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1, h2 {
      text-align: center;
    }
    .info-box {
      background: #f5f5f5;
      padding: 10px 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    label {
      font-weight: bold;
    }
    .question {
      margin-bottom: 15px;
    }
    .question p {
      margin: 0 0 5px 0;
    }
    input[type="text"] {
      width: 100%;
      padding: 6px 8px;
      box-sizing: border-box;
      margin-top: 2px;
    }
    .name-boxes {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .name-boxes input {
      flex: 1;
      min-width: 150px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    #result {
      margin-top: 20px;
      padding: 10px 15px;
      border-radius: 6px;
      background: #e8f5e9;
      display: none;
    }
    #result.error {
      background: #ffebee;
    }
  </style>
</head>
<body>
  <h1>Past Perfect & Past Perfect Continuous Test</h1>
  <h2>Mixed â€“ 30 Questions</h2>

  <div class="info-box">
    <p><strong>Instructions:</strong></p>
    <ul>
      <li>Write the <strong>missing verb phrase</strong> in each sentence (for example: <em>had already cooked</em>, <em>had been studying</em>).</li>
      <li>Capital letters and extra spaces <strong>do not matter</strong>.</li>
      <li>Small spelling mistakes are <strong>accepted</strong>.</li>
    </ul>
  </div>

  <form id="test-form">
    <div class="name-boxes">
      <input type="text" id="student-name" name="studentName" placeholder="Full name (Name and Surname)" required />
    </div>

    <!-- QUESTIONS -->
    <div class="question">
      <p>1. She ______ already ______ (cook) dinner when he arrived.</p>
      <input type="text" name="q1" required />
    </div>

    <div class="question">
      <p>2. ______ they ______ (study) long before the exam started?</p>
      <input type="text" name="q2" required />
    </div>

    <div class="question">
      <p>3. We ______ ______ (not / finish) the task before the teacher checked it.</p>
      <input type="text" name="q3" required />
    </div>

    <div class="question">
      <p>4. I ______ ______ (try) to call you all morning before you answered.</p>
      <input type="text" name="q4" required />
    </div>

    <div class="question">
      <p>5. Why ______ he ______ (cry) before his mother came?</p>
      <input type="text" name="q5" required />
    </div>

    <div class="question">
      <p>6. They ______ ______ (not / see) that movie before yesterday.</p>
      <input type="text" name="q6" required />
    </div>

    <div class="question">
      <p>7. ______ you ______ (wait) long before the door opened?</p>
      <input type="text" name="q7" required />
    </div>

    <div class="question">
      <p>8. The children ______ ______ (play) football for an hour before it began to rain.</p>
      <input type="text" name="q8" required />
    </div>

    <div class="question">
      <p>9. She ______ ______ (not / sleep) well recently.</p>
      <input type="text" name="q9" required />
    </div>

    <div class="question">
      <p>10. I ______ just ______ (wash) my hands before cooking.</p>
      <input type="text" name="q10" required />
    </div>

    <div class="question">
      <p>11. Where ______ she ______ (put) her phone before she lost it?</p>
      <input type="text" name="q11" required />
    </div>

    <div class="question">
      <p>12. We ______ ______ (work) here for five years before we moved.</p>
      <input type="text" name="q12" required />
    </div>

    <div class="question">
      <p>13. He ______ never ______ (be) to Paris before last summer.</p>
      <input type="text" name="q13" required />
    </div>

    <div class="question">
      <p>14. They ______ ______ (not / pay) attention when the teacher entered the room.</p>
      <input type="text" name="q14" required />
    </div>

    <div class="question">
      <p>15. What ______ he ______ (say) before he left the meeting?</p>
      <input type="text" name="q15" required />
    </div>

    <div class="question">
      <p>16. My dad ______ ______ (drive) for two hours before we stopped.</p>
      <input type="text" name="q16" required />
    </div>

    <div class="question">
      <p>17. The students ______ ______ (practice) the song before the show.</p>
      <input type="text" name="q17" required />
    </div>

    <div class="question">
      <p>18. I ______ ______ (not / meet) her until yesterday.</p>
      <input type="text" name="q18" required />
    </div>

    <div class="question">
      <p>19. ______ she ______ (visit) that museum before?</p>
      <input type="text" name="q19" required />
    </div>

    <div class="question">
      <p>20. They ______ already ______ (leave) when we arrived at the station.</p>
      <input type="text" name="q20" required />
    </div>

    <div class="question">
      <p>21. We ______ ______ (look) for tickets for hours before we found the best price.</p>
      <input type="text" name="q21" required />
    </div>

    <div class="question">
      <p>22. She ______ ______ (live) in London for 10 years before she moved to Canada.</p>
      <input type="text" name="q22" required />
    </div>

    <div class="question">
      <p>23. He ______ ______ (not / read) the book before he watched the film.</p>
      <input type="text" name="q23" required />
    </div>

    <div class="question">
      <p>24. ______ they ______ (work) on the project before the teacher asked for it?</p>
      <input type="text" name="q24" required />
    </div>

    <div class="question">
      <p>25. The bus ______ ______ (leave) by the time we got to the stop.</p>
      <input type="text" name="q25" required />
    </div>

    <div class="question">
      <p>26. I ______ ______ (not / eat) breakfast before I went to school.</p>
      <input type="text" name="q26" required />
    </div>

    <div class="question">
      <p>27. Why ______ you ______ (laugh) when the director came in?</p>
      <input type="text" name="q27" required />
    </div>

    <div class="question">
      <p>28. The cat ______ ______ (sleep) on the sofa for hours before we noticed.</p>
      <input type="text" name="q28" required />
    </div>

    <div class="question">
      <p>29. She ______ ______ (not / clean) the room before the guests arrived.</p>
      <input type="text" name="q29" required />
    </div>

    <div class="question">
      <p>30. How long ______ they ______ (play) when the rain started?</p>
      <input type="text" name="q30" required />
    </div>

    <button type="submit">Submit Test</button>
  </form>

  <div id="result"></div>

  <script>
    document.getElementById("test-form").addEventListener("submit", async function (e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      const name = formData.get("studentName") || "";
      const answers = {};

      for (let i = 1; i <= 30; i++) {
        answers["q" + i] = formData.get("q" + i) || "";
      }

      const resultBox = document.getElementById("result");
      resultBox.style.display = "none";
      resultBox.classList.remove("error");
      resultBox.textContent = "";

      try {
        const res = await fetch("/api/submit", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ name, answers })
        });

        const data = await res.json();

        if (!data.success) {
          resultBox.classList.add("error");
          resultBox.textContent = "Something went wrong: " + (data.message || "Unknown error");
        } else {
          resultBox.textContent =
            "Your score: " + data.score + " / " + data.total +
            ". Your result has been sent to the teacher.";
        }
      } catch (err) {
        console.error(err);
        resultBox.classList.add("error");
        resultBox.textContent = "Network error. Please try again.";
      }

      resultBox.style.display = "block";
    });
  </script>
</body>
</html>
